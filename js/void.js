function randRange(t,i){return Math.random()*(i-t)+t}function mapRange(t,i,e,s,n){return s+(n-s)*(t-i)/(e-i)}function distance(t,i){var e=[t[0],t[1],i[0],i[1]],s=e[0],n=e[1],a=e[2],o=e[3];return Math.sqrt(Math.pow(s-a,2)+Math.pow(n-o,2))}function limitToCircle(t,i,e,s,n){if(distance([t,i],[e,s])<=n)return[t,i];t-=e,i-=s;var a=Math.atan2(i,t);return[Math.cos(a)*n+e,Math.sin(a)*n+s]}function isInEllipse(t,i,e,s,n,a){var o=t-e,r=i-s;return o*o/(n*n)+r*r/(a*a)<=1}var IS_HIGH_RES=window.matchMedia("\n      (-webkit-min-device-pixel-ratio: 2),\n      (min--moz-device-pixel-ratio: 2),\n      (-moz-min-device-pixel-ratio: 2),\n      (-o-min-device-pixel-ratio: 2/1),\n      (min-device-pixel-ratio: 2),\n      (min-resolution: 192dpi),\n      (min-resolution: 2dppx)\n    "),IS_MOBILE=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),IS_HIGH_RES_AND_MOBILE=IS_HIGH_RES.matches&&IS_MOBILE,Star=function(){function t(t){var i=t[0],e=t[1];this.FORWARD_SPEED=500,this.SIDEWAYS_SPEED=100,IS_HIGH_RES_AND_MOBILE&&(this.FORWARD_SPEED*=2,this.SIDEWAYS_SPEED*=2),this.container=t,this.x=randRange(-i,i),this.y=randRange(-i,i),this.z=randRange(0,e),this.px=this.x,this.py=this.y,this.pz=this.z,this.color="rgb(".concat(randRange(110,200),",").concat(randRange(110,240),",").concat(randRange(230,255),")")}return t.prototype.resetX=function(){var t=this.container,i=t[0];t[1];this.x=randRange(-i,i),this.px=this.x},t.prototype.resetY=function(){var t=this.container,i=t[0];t[1];this.y=randRange(-i,i),this.py=this.y},t.prototype.resetZ=function(){var t=this.container,i=(t[0],t[1]);this.z=randRange(0,i),this.pz=this.z},t.prototype.update=function(t,i,e,s){this.container=i;var n=i[0],a=i[1],o=n+n/4,r=a-a/4,h=this.FORWARD_SPEED,p=this.SIDEWAYS_SPEED;if(s>0)h*=mapRange(this.z,0,a,1,.01);else if(s<0){h*=mapRange(this.z,0,a,1,.1)}Math.abs(e)>0&&(p*=mapRange(this.z,0,n,.3,.4));let u=Math.sin(t)*randRange(-50,50);this.y-=u,this.z-=h*s*t,this.x-=p*e*t;var c=randRange(a,r),d=randRange(n,o);this.z<1?(this.z=c,this.pz=this.z,this.resetX(),this.resetY()):this.z>a?(this.z=0,this.pz=this.z,this.resetX(),this.resetY()):this.x<-d?(this.x=n,this.px=this.x,this.resetY(),this.resetZ()):this.x>d?(this.x=-n,this.px=this.x,this.resetY(),this.resetZ()):this.y<-d?(this.y=n,this.py=this.y,this.resetX(),this.resetZ()):this.y>d&&(this.y=-n,this.py=this.y,this.resetX(),this.resetZ())},t.prototype.draw=function(t,i,e,s,n){var a=e[0],o=e[1],r=(i[0],i[1]),h=mapRange(this.x/this.z,0,1,0,a),p=mapRange(this.y/this.z,0,1,0,o),u=mapRange(this.px/this.pz,0,1,0,a),c=mapRange(this.py/this.pz,0,1,0,o),d=IS_HIGH_RES.matches&&IS_MOBILE?4:2,m=Math.min(Math.abs(mapRange(this.z,0,r,d,.01)),d);t.beginPath(),t.arc(h,p,m,0,2*Math.PI),t.fillStyle=this.color,t.fill(),this.px=this.x,this.py=this.y,this.pz=this.z,t.beginPath(),t.moveTo(u,c),t.lineTo(h,p),t.lineWidth=m,t.strokeStyle=this.color,t.stroke()},t}(),getPointerInput=function(t,i,e){void 0===i&&(i=document),void 0===e&&(e=600),t=t||function(t){console.error("PointerInput is missing a callback as the first argument")};var s={x:!1,y:!1,hasMoved:!1,isMoving:!1,wasMoving:!1},n=!1,a=!1,o=function(i){a&&(a=window.cancelAnimationFrame(a)),a=window.requestAnimationFrame((function(){var a,o,r,h;i.touches?(r=(a=[i.touches[0].clientX,i.touches[0].clientY])[0],h=a[1]):(r=(o=[i.clientX,i.clientY])[0],h=o[1]),s.x=r,s.y=h,s.hasMoved||(s.hasMoved=!0),s.wasMoving=s.isMoving,s.isMoving=!0,t(s),n&&(n=clearTimeout(n)),n=setTimeout((function(){s.wasMoving=s.isMoving,s.isMoving=!1,t(s)}),e)}))};return i.addEventListener("touchstart",(function(t){return o(t)}),!0),i.addEventListener("touchmove",(function(t){return o(t)}),!0),i.addEventListener("mousemove",(function(t){return o(t)}),!0),!1},StarField=function(){function t(t,i,e,s){var n=this;void 0===e&&(e=2),void 0===s&&(s=1),this.canvas=i,this.context=i.getContext("2d"),this.resizeTimer=!1,this.isResizing=!1,this.wasResizing=!1,this.containerDepth=e,this.setCanvasSize(),this.howManyStars=t,this.stars=new Array(t),this.populateStarField(),this.prevTime=0,this.deltaTime=.1,this.xSpeed=0,this.zSpeed=1,this.mouseX=0,this.mouseY=.25*i.offsetHeight-66,this.UIFadeDelay=s;getPointerInput((function(t){var i=n.screen,e=i[0],s=i[1];n.mouseX=t.x-e/2,n.mouseY=t.y-s/2,n.mouseMoved=t.hasMoved,n.mouseMoving=t.isMoving,n.zSpeed=mapRange(t.y,0,s,12,-4),n.xSpeed=mapRange(t.x,0,e,-10,10),Math.abs(n.xSpeed)>2&&(n.zSpeed/=Math.abs(n.xSpeed)/2),n.mouseY>0&&(n.zSpeed/=2)})),this.mouseMoved=!1,this.mouseMoving=!1,this.mouseControlAlpha=.1,this.showMouseControls=!0,this.pauseAnimation=!1,this.render(),window.addEventListener("resize",(function(){return n.handleResize()}),!0),window.addEventListener("beforeunload",(function(){return n.rePopulateStarField()}))}return t.prototype.startRenderLoop=function(){var t=this,i=function(e){e*=.001,t.deltaTime=e-t.prevTime,t.prevTime=e,t.pauseAnimation||(t.clearCanvas(),t.render()),window.requestAnimationFrame(i)};window.requestAnimationFrame(i)},t.prototype.pause=function(){this.pauseAnimation=!0},t.prototype.play=function(){this.pauseAnimation=!1},t.prototype.setCanvasSize=function(){this.canvas.width=this.canvas.parentElement.offsetWidth,this.canvas.height=this.canvas.parentElement.offsetHeight;var t=canvas.offsetWidth,i=canvas.offsetHeight,e=Math.max(t,i),s=[t,i],n=[e,e*this.containerDepth];this.container=n,this.screen=s,this.context.translate(t/2,i/2)},t.prototype.populateStarField=function(){for(var t=0;t<this.stars.length;t++)this.stars[t]=new Star(this.container)},t.prototype.emptyStarField=function(){this.stars=new Array(this.howManyStars)},t.prototype.rePopulateStarField=function(){return this.emptyStarField(),this.populateStarField(),null},t.prototype.clearCanvas=function(){var t=this.container,i=t[0];t[1];this.context.clearRect(-i/2,-i/2,i,i)},t.prototype.drawMouseControl=function(){this.context;var t=this.screen,i=(t[0],t[1]),e=.25*i,s=21;s*=mapRange(this.mouseY,-i/2+e,i/2+e,.8,1.2),isInEllipse(this.mouseX,this.mouseY,0,e,50,s)&&(this.xSpeed=0,this.zSpeed=0)},t.prototype.render=function(){this.showMouseControls&&(!this.mouseMoved||this.mouseMoving?(this.mouseControlAlpha=.3,this.drawMouseControl()):(this.mouseControlAlpha-=.25*this.deltaTime/this.UIFadeDelay,this.drawMouseControl()));for(var t=0;t<this.stars.length;t++)this.pauseAnimation||this.stars[t].update(this.deltaTime,this.container,this.xSpeed,this.zSpeed),this.stars[t].draw(this.context,this.container,this.screen,this.mouseX,this.mouseY)},t.prototype.rePopOnResizeStop=function(){this.isResizing&&this.wasResizing,!this.isResizing&&this.wasResizing&&this.rePopulateStarField()},t.prototype.handleResize=function(){var t=this;this.pause(),this.resizeTimer&&(this.resizeTimer=clearTimeout(this.resizeTimer)),this.wasResizing=this.isResizing,this.isResizing||(this.isResizing=!0),this.rePopOnResizeStop(),this.pauseAnimation&&window.requestAnimationFrame((function(){t.setCanvasSize(),t.render()})),this.resizeTimer=setTimeout((function(){t.wasResizing=t.isResizing,t.isResizing=!1,t.rePopOnResizeStop(),t.setCanvasSize(),t.play()}),200)},t.prototype.handleOrientation=function(t){},t}();function setup(){var t=document.getElementById("canvas"),i=1e3;IS_MOBILE&&(i=500),new StarField(i,t).startRenderLoop()}window.onload=setup();